<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Generator Game</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      background: #23272b;
      color: #fff;
      font-family: 'Segoe UI', 'Consolas', monospace, Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    main {
      max-width: 800px;
      margin: 0 auto;
      padding: 16px;
    }
    h1 {
      color: #ffd600;
      font-family: monospace;
      letter-spacing: 2px;
      margin-bottom: 24px;
      text-align: left;
    }
    .main-stats {
      margin: 24px 0 24px 0;
    }
    .main-stats > div {
      background: #23272b;
      border-radius: 8px;
      padding: 12px 16px;
      margin-bottom: 12px;
      font-size: 1.2em;
      box-shadow: 0 2px 8px #0002;
      color: #ffd600;
      font-family: monospace;
      letter-spacing: 1px;
    }
    .generator-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
      background: #23272b;
      border-radius: 8px;
      padding: 12px 8px;
      box-shadow: 0 2px 8px #0002;
    }
    .generator-label {
      min-width: 180px;
      font-size: 1em;
      word-break: break-word;
      color: #fffde7;
      margin-bottom: 0;
      font-family: monospace;
      font-weight: 500;
      letter-spacing: 1px;
    }
    .generator-btn, .upgrade-btn, .sell-btn, .max-btn {
      margin: 0 2px;
      padding: 8px 14px;
      border-radius: 5px;
      border: none;
      font-weight: bold;
      cursor: pointer;
      background: #444;
      color: #fff;
      transition: background 0.2s;
      font-size: 1em;
      min-width: 170px;
      margin-bottom: 0;
      box-shadow: 0 1px 4px #0002;
      white-space: nowrap;
    }
    .generator-btn:disabled, .upgrade-btn:disabled, .sell-btn:disabled, .max-btn:disabled {
      background: #222;
      color: #888;
      cursor: not-allowed;
    }
    .upgrade-btn { background: #1976d2; }
    .upgrade-btn:disabled { background: #123a5e; }
    .sell-btn { background: #c62828; }
    .sell-btn:disabled { background: #5e1212; }
    .max-btn { background: #388e3c; }
    .max-btn:disabled { background: #1b3c1b; color: #888; cursor: not-allowed; }
    #toast-container {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 9999;
    }
    #toast-container .toast {
      background: #23272b;
      color: #fff;
      padding: 16px 28px;
      margin-top: 12px;
      border-radius: 8px;
      box-shadow: 0 2px 12px #0008;
      font-size: 1.1em;
      opacity: 0.95;
      animation: toast-in 0.3s;
      min-width: 180px;
    }
    @keyframes toast-in {
      from { transform: translateY(40px); opacity: 0; }
      to   { transform: translateY(0);    opacity: 0.95; }
    }
    .menu-bar {
      margin: 0 0 16px 0;
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }
    .menu-button {
      background: #444;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 8px 16px;
      font-weight: bold;
      cursor: pointer;
      font-size: 1em;
      margin-right: 4px;
      margin-bottom: 4px;
      transition: background 0.2s;
    }
    .menu-button:active {
      background: #222;
    }
    #username {
      padding: 8px 12px;
      border-radius: 5px;
      border: none;
      font-size: 1em;
      margin-right: 4px;
      margin-bottom: 4px;
      background: #181a1b;
      color: #fff;
    }
    #purchase-multiplier-container {
      margin: 12px 0 12px 0;
    }
    #purchase-multiplier {
      padding: 4px 8px;
      border-radius: 4px;
      border: none;
      font-size: 1em;
      background: #181a1b;
      color: #fff;
    }
    @media (max-width: 700px) {
      main {
        padding: 0 2vw;
      }
      .main-stats > div {
        font-size: 1em;
        padding: 10px 8px;
      }
      .generator-row {
        flex-direction: column;
        align-items: stretch;
        gap: 4px;
        padding: 10px 4px;
      }
      .generator-label {
        min-width: 0;
        font-size: 1em;
        margin-bottom: 2px;
        text-align: left;
      }
      .generator-btn, .upgrade-btn, .sell-btn, .max-btn {
        min-width: 0;
        width: 100%;
        font-size: 1em;
        margin: 2px 0;
        padding: 10px 0;
      }
      #toast-container {
        right: 4vw;
        left: 4vw;
        bottom: 12px;
      }
      #toast-container .toast {
        min-width: 0;
        width: 100%;
        font-size: 1em;
        padding: 12px 8px;
      }
    }
  </style>
</head>
<body>
  <div id="purchase-multiplier-container">
    <label for="purchase-multiplier">Purchase:</label>
    <select id="purchase-multiplier">
      <option value="1">1x</option>
      <option value="2">2x</option>
      <option value="5">5x</option>
      <option value="10">10x</option>
      <option value="50">50x</option>
      <option value="100">100x</option>
      <option value="1000">1,000x</option>
    </select>
  </div>
  <div class="menu-bar">
    <button id="homeBtn" class="menu-button">Home</button>
    <input type="text" id="username" placeholder="Username">
    <button id="saveBtn" class="menu-button">Save Game</button>
    <button id="loadBtn" class="menu-button">Load Game</button>
    <button id="resetBtn" class="menu-button">Reset Game</button>
  </div>
  <main>
    <h1>Generators Game</h1>
    <div class="main-stats">
      <div id="energy">Total Energy: 10</div>
      <div id="eps">EPS: 0</div>
      <div id="generators">Generators: 0</div>
    </div>
    <section id="generators-section">
      <div class="generator-row">
        <span id="generatorsCoal" class="generator-label">Coal Generators: 0 / 100</span>
        <button id="generateCoal" class="generator-btn">Buy Coal Generator (Cost: 10)</button>
        <button id="sellCoal" class="sell-btn">Sell</button>
        <button id="upgradeCoal" class="upgrade-btn">Upgrade (Cost: 1k)</button>
        <button id="maxCoal" class="max-btn">Max+ (Cost: 1k) [+100]</button>
      </div>
      <div class="generator-row">
        <span id="generatorsIron" class="generator-label">Iron Generators: 0 / 100</span>
        <button id="generateIron" class="generator-btn">Buy Iron Generator (Cost: 1k)</button>
        <button id="sellIron" class="sell-btn">Sell</button>
        <button id="upgradeIron" class="upgrade-btn">Upgrade (Cost: 1k)</button>
        <button id="maxIron" class="max-btn">Max+ (Cost: 1k) [+100]</button>
      </div>
      <div class="generator-row">
        <span id="generatorsGold" class="generator-label">Gold Generators: 0 / 50</span>
        <button id="generateGold" class="generator-btn">Buy Gold Generator (Cost: 3k)</button>
        <button id="sellGold" class="sell-btn">Sell</button>
        <button id="upgradeGold" class="upgrade-btn">Upgrade (Cost: 1k)</button>
        <button id="maxGold" class="max-btn">Max+ (Cost: 1k) [+50]</button>
      </div>
      <div class="generator-row">
        <span id="generatorsRuby" class="generator-label">Ruby Generators: 0 / 25</span>
        <button id="generateRuby" class="generator-btn">Buy Ruby Generator (Cost: 6k)</button>
        <button id="sellRuby" class="sell-btn">Sell</button>
        <button id="upgradeRuby" class="upgrade-btn">Upgrade (Cost: 1k)</button>
        <button id="maxRuby" class="max-btn">Max+ (Cost: 1k) [+25]</button>
      </div>
      <div class="generator-row">
        <span id="generatorsEmerald" class="generator-label">Emerald Generators: 0 / 10</span>
        <button id="generateEmerald" class="generator-btn">Buy Emerald Generator (Cost: 9k)</button>
        <button id="sellEmerald" class="sell-btn">Sell</button>
        <button id="upgradeEmerald" class="upgrade-btn">Upgrade (Cost: 1k)</button>
        <button id="maxEmerald" class="max-btn">Max+ (Cost: 1k) [+10]</button>
      </div>
      <div class="generator-row">
        <span id="generatorsDiamond" class="generator-label">Diamond Generators: 0 / 1</span>
        <button id="generateDiamond" class="generator-btn">Buy Diamond Generator (Cost: 1Qa)</button>
        <button id="sellDiamond" class="sell-btn">Sell</button>
        <button id="upgradeDiamond" class="upgrade-btn">Upgrade (Cost: 1Qa)</button>
        <button id="maxDiamond" class="max-btn">Max+ (Cost: 1Qa) [+1]</button>
      </div>
    </section>
  </main>
  <div id="toast-container"></div>
<script src="https://cdn.jsdelivr.net/npm/bignumber.js@9.1.2/bignumber.min.js"></script>
<script>
  // --- Toast Notification ---
  function showToast(message) {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(() => {
      toast.style.transition = 'opacity 0.5s';
      toast.style.opacity = '0';
      setTimeout(() => container.removeChild(toast), 500);
    }, 2000);
  }

  // --- Default Game Data ---
  const defaultGameData = {
    energy: "10",
    eps: "0",
    generators: "0",
    generatorsCoal: "0",
    generatorsIron: "0",
    generatorsGold: "0",
    generatorsRuby: "0",
    generatorsEmerald: "0",
    generatorsDiamond: "0",
    generatorMax: { coal: 100, iron: 100, gold: 50, ruby: 25, emerald: 10, diamond: 1 }
  };

  let username = "";
  let gameData = JSON.parse(JSON.stringify(defaultGameData));
  let multiplier = 1;

  // --- Upgrades State ---
  const generatorUpgrades = {
    coal:    { level: 0, cost: new BigNumber(1000) },
    iron:    { level: 0, cost: new BigNumber(1000) },
    gold:    { level: 0, cost: new BigNumber(1000) },
    ruby:    { level: 0, cost: new BigNumber(1000) },
    emerald: { level: 0, cost: new BigNumber(1000) },
    diamond: { level: 0, cost: new BigNumber("1e15") } // 1Qa
  };

  // --- Max Upgrade State ---
  const generatorMaxUpgrades = {
    coal:    { cost: new BigNumber(1000), increment: 100 },
    iron:    { cost: new BigNumber(1000), increment: 100 },
    gold:    { cost: new BigNumber(1000), increment: 100 },
    ruby:    { cost: new BigNumber(1000), increment: 100 },
    emerald: { cost: new BigNumber(1000), increment: 100 },
    diamond: { cost: new BigNumber("1e15"), increment: 1 }
  };

  // --- Generator Config ---
  const generatorConfig = {
    coal:    { baseCost: new BigNumber(10),    power: () => 1 + generatorUpgrades.coal.level,  key: "generatorsCoal",    label: "Coal Generators",    button: "generateCoal",    span: "generatorsCoal",    max: defaultGameData.generatorMax.coal, upgrade: "upgradeCoal", sell: "sellCoal", maxBtn: "maxCoal" },
    iron:    { baseCost: new BigNumber(1000),  power: () => 3 + generatorUpgrades.iron.level,  key: "generatorsIron",    label: "Iron Generators",    button: "generateIron",    span: "generatorsIron",    max: defaultGameData.generatorMax.iron, upgrade: "upgradeIron", sell: "sellIron", maxBtn: "maxIron" },
    gold:    { baseCost: new BigNumber(3000),  power: () => 8 + generatorUpgrades.gold.level,  key: "generatorsGold",    label: "Gold Generators",    button: "generateGold",    span: "generatorsGold",    max: defaultGameData.generatorMax.gold, upgrade: "upgradeGold", sell: "sellGold", maxBtn: "maxGold" },
    ruby:    { baseCost: new BigNumber(6000),  power: () => 20 + generatorUpgrades.ruby.level, key: "generatorsRuby",    label: "Ruby Generators",    button: "generateRuby",    span: "generatorsRuby",    max: defaultGameData.generatorMax.ruby, upgrade: "upgradeRuby", sell: "sellRuby", maxBtn: "maxRuby" },
    emerald: { baseCost: new BigNumber(9000),  power: () => 50 + generatorUpgrades.emerald.level, key: "generatorsEmerald", label: "Emerald Generators", button: "generateEmerald", span: "generatorsEmerald", max: defaultGameData.generatorMax.emerald, upgrade: "upgradeEmerald", sell: "sellEmerald", maxBtn: "maxEmerald" },
    diamond: { baseCost: new BigNumber("1e15"), power: () => 1e8 + generatorUpgrades.diamond.level * 1e8, key: "generatorsDiamond", label: "Diamond Generators", button: "generateDiamond", span: "generatorsDiamond", max: defaultGameData.generatorMax.diamond, upgrade: "upgradeDiamond", sell: "sellDiamond", maxBtn: "maxDiamond" }
  };

  // --- Helpers ---
  function getEnergy() { return new BigNumber(gameData.energy); }
  function setEnergy(val) { gameData.energy = val.toString(); }
  function getEPS() { return new BigNumber(gameData.eps); }
  function setEPS(val) { gameData.eps = val.toString(); }
  function getGenCount(key) { return new BigNumber(gameData[key]); }
  function setGenCount(key, val) { gameData[key] = val.toString(); }
  function getTotalGenerators() { return new BigNumber(gameData.generators); }
  function setTotalGenerators(val) { gameData.generators = val.toString(); }

  function formatNumber(num) {
    if (!(num instanceof BigNumber)) num = new BigNumber(num);
    const suffixes = ['', 'k', 'm', 'b', 't', 'Qa', 'Qi', 'Sx', 'Sp', 'Oc', 'No', 'Dc'];
    if (num.isLessThan(1000)) return num.toFixed(2).replace(/\.00$/, '');
    const exponent = num.e;
    const tier = Math.floor(exponent / 3);
    if (tier >= suffixes.length) return num.toExponential(3);
    const scaled = num.dividedBy(new BigNumber(10).pow(tier * 3));
    return scaled.toFixed(2).replace(/\.00$/, '') + suffixes[tier];
  }

  function getTotalCost(base, owned, amount) {
    return base.times(amount); // flat cost
  }

  // --- EPS Calculation ---
  function recalculateEPS() {
    let total = new BigNumber(0);
    for (const key in generatorConfig) {
      total = total.plus(getGenCount(generatorConfig[key].key).times(generatorConfig[key].power()));
    }
    setEPS(total);
  }

  // --- UI Update ---
  function updateAllUI() {
    document.getElementById('energy').textContent = `Total Energy: ${formatNumber(getEnergy())}`;
    document.getElementById('eps').textContent = `EPS: ${formatNumber(getEPS())}`;
    document.getElementById('generators').textContent = `Generators: ${formatNumber(getTotalGenerators())}`;

    for (const key in generatorConfig) {
      const gen = generatorConfig[key];
      const owned = getGenCount(gen.key);

      // Upgrade info
      const upgrade = generatorUpgrades[key];
      const upgradeBtn = document.getElementById(gen.upgrade);
      upgradeBtn.textContent = `Upgrade (Cost: ${formatNumber(upgrade.cost)}) [+${gen.power()}]`;
      upgradeBtn.disabled = !getEnergy().gte(upgrade.cost) || owned.lte(0);

      // Max upgrade info
      const maxBtn = document.getElementById(gen.maxBtn);
      const maxUpgrade = generatorMaxUpgrades[key];
      maxBtn.textContent = `Max+ (Cost: ${formatNumber(maxUpgrade.cost)}) [+${gen.max}]`;
      maxBtn.disabled = !getEnergy().gte(maxUpgrade.cost);

      // Sell info
      const sellBtn = document.getElementById(gen.sell);
      sellBtn.disabled = owned.lte(0);

      if (owned.gte(gen.max)) {
        document.getElementById(gen.span).textContent = `${gen.label}: ${formatNumber(owned)} / ${gen.max}`;
        const btn = document.getElementById(gen.button);
        btn.textContent = `${gen.label} (MAXED)`;
        btn.disabled = true;
        continue;
      }

      const cost = getTotalCost(gen.baseCost, owned, multiplier);
      document.getElementById(gen.span).textContent = `${gen.label}: ${formatNumber(owned)} / ${gen.max}`;
      const btn = document.getElementById(gen.button);
      btn.textContent = `Buy ${gen.label.replace('s', '')} (Cost: ${formatNumber(cost)})`;
      btn.disabled = !getEnergy().gte(cost);
    }
  }

  // --- Purchase Logic ---
  function purchaseGenerator(key) {
    const gen = generatorConfig[key];
    const owned = getGenCount(gen.key);

    if (owned.gte(gen.max)) return;

    let actualBuyAmount = Math.min(multiplier, gen.max - owned.toNumber());
    const cost = getTotalCost(gen.baseCost, owned, actualBuyAmount);

    if (getEnergy().gte(cost)) {
      setEnergy(getEnergy().minus(cost));
      setGenCount(gen.key, owned.plus(actualBuyAmount));
      setTotalGenerators(getTotalGenerators().plus(actualBuyAmount));
      recalculateEPS();
      updateAllUI();
    }
  }

  // --- Sell Logic ---
  function sellGenerator(key) {
    const gen = generatorConfig[key];
    const owned = getGenCount(gen.key);
    if (owned.lte(0)) return;
    setGenCount(gen.key, owned.minus(1));
    setTotalGenerators(getTotalGenerators().minus(1));
    setEnergy(getEnergy().plus(gen.baseCost.times(0.5)));
    recalculateEPS();
    updateAllUI();
  }

  // --- Upgrade Logic (per generator) ---
  function upgradeGenerator(key) {
    const gen = generatorConfig[key];
    const upgrade = generatorUpgrades[key];
    const owned = getGenCount(gen.key);
    if (getEnergy().gte(upgrade.cost) && owned.gt(0)) {
      setEnergy(getEnergy().minus(upgrade.cost));
      upgrade.level += 1;
      upgrade.cost = upgrade.cost.times(2); // Double cost each time
      recalculateEPS();
      updateAllUI();
    }
  }

  // --- Max Upgrade Logic (per generator) ---
  function upgradeMaxGenerator(key) {
    const gen = generatorConfig[key];
    const maxUpgrade = generatorMaxUpgrades[key];
    if (getEnergy().gte(maxUpgrade.cost)) {
      setEnergy(getEnergy().minus(maxUpgrade.cost));
      gen.max += maxUpgrade.increment;
      gameData.generatorMax[key] = gen.max;
      maxUpgrade.cost = maxUpgrade.cost.times(2); // Double cost each time
      updateAllUI();
    }
  }

  // --- Save / Load / Reset ---
  function saveGame() {
    username = document.getElementById('username').value.trim();
    if (!username) { showToast('Enter your username before saving.'); return; }

    const saveCopy = { ...gameData, generatorMax: {} };
    for (const key in generatorConfig) {
      saveCopy.generatorMax[key] = generatorConfig[key].max;
    }
    // Save upgrades
    saveCopy.generatorUpgrades = {};
    for (const key in generatorUpgrades) {
      saveCopy.generatorUpgrades[key] = {
        level: generatorUpgrades[key].level,
        cost: generatorUpgrades[key].cost.toString()
      };
    }
    // Save max upgrades
    saveCopy.generatorMaxUpgrades = {};
    for (const key in generatorMaxUpgrades) {
      saveCopy.generatorMaxUpgrades[key] = {
        cost: generatorMaxUpgrades[key].cost.toString()
      };
    }

    localStorage.setItem(username, JSON.stringify(saveCopy));
    localStorage.setItem('lastUsername', username);
    showToast('Game saved!');
  }

  function loadGame() {
    username = document.getElementById('username').value.trim();
    if (!username) { showToast('Enter a username first.'); return; }

    const savedData = localStorage.getItem(username);
    if (savedData) {
      const saved = JSON.parse(savedData);
      gameData = saved;

      if (saved.generatorMax) {
        for (const key in saved.generatorMax) {
          generatorConfig[key].max = saved.generatorMax[key];
        }
      }
      // Load upgrades
      if (saved.generatorUpgrades) {
        for (const key in saved.generatorUpgrades) {
          generatorUpgrades[key].level = saved.generatorUpgrades[key].level;
          generatorUpgrades[key].cost = new BigNumber(saved.generatorUpgrades[key].cost);
        }
      }
      // Load max upgrades
      if (saved.generatorMaxUpgrades) {
        for (const key in saved.generatorMaxUpgrades) {
          if (saved.generatorMaxUpgrades[key].cost)
            generatorMaxUpgrades[key].cost = new BigNumber(saved.generatorMaxUpgrades[key].cost);
        }
      }
      recalculateEPS();
      updateAllUI();
      showToast('Game loaded!');
    } else {
      showToast('No save found for this username.');
    }
  }

  function resetGame() {
    if (confirm("Are you sure you want to reset your game? This cannot be undone!")) {
      gameData = JSON.parse(JSON.stringify(defaultGameData));
      for (const key in generatorConfig) {
        generatorConfig[key].max = defaultGameData.generatorMax[key];
      }
      // Reset upgrades
      for (const key in generatorUpgrades) {
        generatorUpgrades[key].level = 0;
        generatorUpgrades[key].cost = key === "diamond" ? new BigNumber("1e15") : new BigNumber(1000);
      }
      // Reset max upgrades
      for (const key in generatorMaxUpgrades) {
        generatorMaxUpgrades[key].cost = key === "diamond" ? new BigNumber("1e15") : new BigNumber(1000);
      }
      if (username) {
        localStorage.removeItem(username);
      }
      recalculateEPS();
      updateAllUI();
      showToast("Game reset to original state!");
    }
  }

  // --- Start Game After DOM Loads ---
  window.onload = function() {
    document.getElementById('purchase-multiplier').onchange = function() {
      multiplier = parseInt(this.value, 10);
      updateAllUI();
    };

    for (const key in generatorConfig) {
      document.getElementById(generatorConfig[key].button).onclick = () => purchaseGenerator(key);
      document.getElementById(generatorConfig[key].sell).onclick = () => sellGenerator(key);
      document.getElementById(generatorConfig[key].upgrade).onclick = () => upgradeGenerator(key);
      document.getElementById(generatorConfig[key].maxBtn).onclick = () => upgradeMaxGenerator(key);
    }

    document.getElementById('saveBtn').onclick = saveGame;
    document.getElementById('loadBtn').onclick = loadGame;
    document.getElementById('resetBtn').onclick = resetGame;

    // Auto-load last user
    const lastUser = localStorage.getItem('lastUsername');
    if (lastUser) {
      document.getElementById('username').value = lastUser;
      username = lastUser;
      loadGame();
    } else {
      recalculateEPS();
      updateAllUI();
    }

    // Game loop
    setInterval(() => {
      let totalAdd = new BigNumber(0);
      for (const key in generatorConfig) {
        totalAdd = totalAdd.plus(getGenCount(generatorConfig[key].key).times(generatorConfig[key].power()));
      }
      setEnergy(getEnergy().plus(totalAdd));
      recalculateEPS();
      updateAllUI();
    }, 1000);
  };
</script>
</body>
</html>